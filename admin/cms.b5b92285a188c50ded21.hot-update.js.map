{"version":3,"file":"cms.b5b92285a188c50ded21.hot-update.js","sources":["webpack:///./src/cms/CKEditorWidget.js"],"sourcesContent":["/* eslint-disable react/prefer-stateless-function */\n/* eslint-disable react/prop-types */\n// eslint-disable-next-line max-classes-per-file\nimport React from 'react';\nimport { v4 as uuidv4 } from 'uuid';\nimport CKEditor from '@ckeditor/ckeditor5-react';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport { Map } from 'immutable';\nimport BallonBlockEditor from '@ckeditor/ckeditor5-build-balloon-block';\n\nclass CKEditorWidget extends React.Component {\n  currentUid = null;\n\n  usedUids = [];\n\n  pathRegistry = {};\n\n  onChange = (event, editor) => {\n    let data = editor.getData() || '';\n    Object.keys(this.pathRegistry).forEach((url) => {\n      data = data.split(url).join(this.pathRegistry[url]);\n    });\n    this.props.onChange(data);\n  };\n\n  openMediaLibrary() {\n    const { field, onOpenMediaLibrary, value } = this.props;\n    this.currentUid = uuidv4();\n    this.usedUids.push(this.currentUid);\n    return onOpenMediaLibrary({\n      controlID: this.currentUid,\n      forImage: false,\n      privateUpload: field.get('private'),\n      value,\n      allowMultiple: false,\n      config: field.get('media_library', Map()).get('config'),\n      field,\n    });\n  }\n\n  componentDidUpdate() {\n    const { mediaPaths, getAsset } = this.props;\n    const mediaPath = this.currentUid && mediaPaths.get(this.currentUid);\n    if (mediaPath) {\n      this.props.onRemoveMediaControl(this.currentUid);\n      this.currentUid = null;\n      this.editor.model.change((writer) => {\n        const { url } = getAsset(mediaPath);\n        const imageElement = writer.createElement('image', {\n          src: url,\n        });\n\n        this.pathRegistry[url] = mediaPath;\n\n        // Insert the image in the current selection location.\n        this.editor.model.insertContent(\n          imageElement,\n          this.editor.model.document.selection,\n        );\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    this.usedUids.forEach((id) => this.props.onRemoveMediaControl(id));\n  }\n\n  render() {\n    const {\n      forID,\n      classNameWrapper,\n      setActiveStyle,\n      setInactiveStyle,\n      value,\n    } = this.props;\n\n    let data = value || '';\n    Object.keys(this.pathRegistry).forEach((url) => {\n      data = data.split(`src=${this.pathRegistry[url]}`).join(`src=${url}`);\n    });\n    return (\n      <div\n        className={classNameWrapper}\n        style={{\n          paddingLeft: 10,\n          paddingRight: 10,\n          minHeight: 200,\n        }}\n      >\n        <CKEditor\n          id={forID}\n          editor={BallonBlockEditor}\n          onInit={(editor) => {\n            this.editor = editor;\n          }}\n          config={{\n            insertImage: {\n              openMediaLibrary: () => {\n                this.openMediaLibrary();\n              },\n            },\n          }}\n          data={data}\n          onChange={this.onChange}\n          onBlur={() => setInactiveStyle()}\n          onFocus={() => setActiveStyle()}\n          style={{ outline: 'none' }}\n        />\n      </div>\n    );\n  }\n}\n\nexport default CKEditorWidget;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;;;;;;;;;;;;;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AADA;AAIA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAHA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AADA;AAOA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAqBA;AACA;;;;;;;;AArGA;AACA;AAsGA;AAAA;;;;;;;;;;AAvGA;;;;;;;;;;;;;;A","sourceRoot":""}